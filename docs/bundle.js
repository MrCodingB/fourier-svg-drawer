(()=>{"use strict";var t=function(){function t(t,e,n){this.scaleX=t,this.scaleY=e,this.frequency=n,this.k=this.frequency*Math.PI_2,this.vectorRadius=Math.sqrt(this.scaleX*this.scaleX+this.scaleY*this.scaleY)}return t.prototype.getAngle=function(t){return this.k*t},t}(),e=.005,n="#fff",r=function(){function r(t,e,n,r){this.x0=t,this.y0=e,this.terms=n,this.path=r}return r.fromPath=function(n,i){console.log("Getting fourier from path");var o=n.getTotalLength(),a=o*e;console.log("n = ".concat(2*i+1,", dt = ").concat(e,", dl = ").concat(a,", l = ").concat(o));for(var s=[],c=[],l=0,h=0;l<=1;){for(var u=l*Math.PI_2,f=n.getPointAtLength(h),p=0,d=-i;p<=2*i;p++,d++){0===l&&(s[p]=0,c[p]=0);var y=-d*u,v=Math.cos(y),g=Math.sin(y),m=v*f.x-g*f.y,b=v*f.y+f.x*g;s[p]+=m,c[p]+=b}l+=e,h+=a}var x=[];for(p=0;p<=2*i;p++)s[p]*=e,c[p]*=e,p!==i&&x.push(new t(s[p],c[p],p-i));return console.log("Calculated fourier"),new r(s[i],c[i],x,n)},r.prototype.changeMaxVectorIndex=function(t){return r.fromPath(this.path,t)},r.prototype.drawValue=function(t,e,r){var i,o,a=this.x0,s=this.y0;e.beginPath(),e.moveTo(0,0),e.lineTo(a,s),e.strokeStyle=n,e.stroke();try{for(var c=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.terms),l=c.next();!l.done;l=c.next()){var h=l.value,u=h.scaleX,f=h.scaleY,p=h.getAngle(t),d=Math.cos(p),y=Math.sin(p),v=d*u-y*f,g=d*f+u*y;e.beginPath(),e.arc(a,s,h.vectorRadius,0,Math.PI_2),e.strokeStyle="#0f97d1",e.stroke(),this.drawVector(e,a,s,v,g,h.vectorRadius),a+=v,s+=g}}catch(t){i={error:t}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}r.push(a,s)},r.prototype.drawVector=function(t,e,r,i,o,a){var s=.2*a,c=e+i,l=r+o,h=Math.atan2(o,i),u=Math.PI/12,f=h-u,p=h+u;t.beginPath(),t.moveTo(e,r),t.lineTo(c,l),t.strokeStyle=n,t.stroke(),t.beginPath(),t.moveTo(c,l),t.lineTo(c-s*Math.cos(f),l-s*Math.sin(f)),t.lineTo(c-s*Math.cos(p),l-s*Math.sin(p)),t.closePath(),t.fillStyle=n,t.fill()},r}(),i=function(){function t(t){this.items=[],this.i=-1,this.length=0,this.clearResize(t)}return Object.defineProperty(t.prototype,"count",{get:function(){return this.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"capacity",{get:function(){return this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.length<1},enumerable:!1,configurable:!0}),t.prototype.get=function(t){if(!(t>=this.length)){var e=this.i+t;return e>=this.capacity&&(e-=this.capacity),this.items[e]}},t.prototype.first=function(){return this.length<1?void 0:this.items[this.i]},t.prototype.push=function(t,e){this.i--,this.i<0&&(this.i=this.capacity-1),this.items[this.i].x=t,this.items[this.i].y=e,this.length<this.capacity&&this.length++},t.prototype.clearResize=function(t){if(this.clear(),t>this.capacity)for(var e=this.capacity;e<t;e++)this.items.push({x:0,y:0});else if(t<this.capacity){var n=this.capacity-t;this.items.splice(t,n)}},t.prototype.clear=function(){this.i=-1,this.length=0},t.prototype[Symbol.iterator]=function(){var t;return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(e){switch(e.label){case 0:if(this.length<1||this.i<0)return[2];t=this.i,e.label=1;case 1:return[4,this.items[t]];case 2:e.sent(),++t>=this.capacity&&(t=0),e.label=3;case 3:if(t!==this.i&&(this.length===this.capacity||t>this.i))return[3,1];e.label=4;case 4:return[2]}}))},t}(),o=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},a=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=function(){function t(t,e,n,r){var o=this;this.canvas=t,this.context=e,this.showTraceInput=n,this.maxVectorIndexInput=r,this.dl=2,this.renderDelay=4,this.points=new i(0),this.t=0,this.dt=0,this.showTrace=!0,this.maxTermIndex=50,document.ondragover=function(t){return t.preventDefault()},document.ondrop=function(t){return o.onDrop(t)},this.showTraceInput.oninput=function(t){t.target instanceof HTMLInputElement&&(o.showTrace=t.target.checked)},this.maxVectorIndexInput.oninput=function(t){var e;if(t.target instanceof HTMLInputElement){var n=parseInt(t.target.value);o.maxTermIndex=isNaN(n)?50:n,o.currentFourier=null===(e=o.currentFourier)||void 0===e?void 0:e.changeMaxVectorIndex(o.maxTermIndex),o.points.clear();var r=t.target.parentElement;if(r instanceof HTMLLabelElement){var i=r.querySelector("span");null!==i&&(i.innerText="Vector count: ".concat(2*o.maxTermIndex+1))}}},this.renderLoop()}return t.start=function(e,n){var r=document.createElement("canvas");document.body.appendChild(r),document.body.onresize=function(){r.width=r.clientWidth,r.height=r.clientHeight},r.width=r.clientWidth,r.height=r.clientHeight;var i=r.getContext("2d");if(null===i)throw new Error("Could not create canvas rendering context");new t(r,i,e,n)},t.prototype.onDrop=function(t){var e;return o(this,void 0,void 0,(function(){var n,r,i,o,s,c,l;return a(this,(function(a){switch(a.label){case 0:if(t.preventDefault(),void 0===(n=null===(e=t.dataTransfer)||void 0===e?void 0:e.files)||n.length<1)return[2];r=0,a.label=1;case 1:return r<n.length?null===(i=n[r])||"image/svg+xml"!==i.type?[3,4]:[4,i.text()]:[3,5];case 2:return o=a.sent(),s=new DOMParser,c=s.parseFromString(o,"image/svg+xml"),null===(l=c.querySelector("path"))?[3,4]:[4,this.processNewPath(l)];case 3:return a.sent(),[3,5];case 4:return r++,[3,1];case 5:return[2]}}))}))},t.prototype.processNewPath=function(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(n){return this.currentFourier=r.fromPath(t,this.maxTermIndex),e=t.getTotalLength(),this.dt=this.dl/e,this.t=0,this.points.clearResize(e/this.dl),this.clearCanvas(),[2]}))}))},t.prototype.render=function(){var t,e;if(this.clearCanvas(),void 0!==this.currentFourier){if(this.currentFourier.drawValue(this.t,this.context,this.points),this.showTrace){var n=this.points.count;try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.points),i=r.next();!i.done;i=r.next()){var o=i.value;this.drawPoint(o.x,o.y,"rgba(255, 247, 0, ".concat(n/this.points.count+.2,")")),n--}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}else void 0!==(o=this.points.first())&&this.drawPoint(o.x,o.y,"#fff700");this.t+=this.dt}},t.prototype.renderLoop=function(){var t=this;this.render(),setTimeout((function(){return t.renderLoop()}),this.renderDelay)},t.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.drawPoint=function(t,e,n){this.context.beginPath(),this.context.arc(t,e,3,0,Math.PI_2),this.context.fillStyle=n,this.context.fill()},t}();window.onload=function(){var t=document.querySelector("input#showTraceCheckbox"),e=document.querySelector("input#maxVectorIndexRange");if(!(t instanceof HTMLInputElement&&e instanceof HTMLInputElement))throw new Error("Could not load essential elements");s.start(t,e)},Object.defineProperty(Math,"PI_2",{value:2*Math.PI})})();